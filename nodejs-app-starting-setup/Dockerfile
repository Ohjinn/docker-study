# 1. 도커 허브나 로컬의 이미지 이름을 넣는다.
FROM node:12

WORKDIR /app

# 2. 첫 번째 항목은 로컬 파일 시스템에서 도커 이미지화 할 디렉토리. 지금은 Dockerfile이 포함된 디렉토리를 의미한다.
# 3. 두 번째 항목은 이미지 내부의 경로를 의미한다. 로컬에 있는 파일들이 이미지 내부의 /app으로 복사된다.
COPY . /app
# 5. WORKDIR에 의해 작업 루트가 재설정됐기 때문에 아래와 같은 상대경로로 적어도 된다. 하지만 절대경로가 선호된다.
# COPY . ./

# 4. 복사된 이미지 안에서 실행할 명령어들을 적는데 기본 디렉토리가 root이므로 /app으로 이동해야 한다. 그게 두번째 줄의 WORKDIR이다.
RUN npm install

# 7. 도커 컨테이너는 격리돼 있기 때문에 이전에 사용한 docker run -p 3000:3000 처럼 로컬 머신에서 포트를 이어줘야 한다.
EXPOSE 80

# 6. RUN node server.js로 할 수도 있지만 우리는 이미지에서 node server를 실행하고 싶은 것이 아니라 컨테이너를 실행할 때만 실행하고 싶기 때문에 CMD 명령어를 사용한다.
CMD [ "node", "server.js" ]
